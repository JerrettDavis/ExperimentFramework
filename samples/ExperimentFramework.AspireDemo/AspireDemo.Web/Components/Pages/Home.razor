@page "/"
@using AspireDemo.Web
@using AspireDemo.Web.Components.Shared
@using AspireDemo.Web.Services
@implements IDisposable
@inject ExperimentApiClient ExperimentApi
@inject DemoStateService DemoState

<SetPageTitle Title="Dashboard - OptimizeLab" />

<div class="dashboard">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="header-title">
                <h1>Experimentation Dashboard</h1>
                <p class="header-subtitle">Monitor and optimize your product experiments</p>
            </div>
            <div class="header-actions">
                <button class="btn-secondary" @onclick="RefreshData" disabled="@_loading">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                    @(_loading ? "Refreshing..." : "Refresh")
                </button>
                <a href="experiments" class="btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Manage Experiments
                </a>
            </div>
        </div>
    </header>

    <!-- KPI Cards -->
    <section class="kpi-section">
        <div class="kpi-card">
            <div class="kpi-icon blue">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 19v-6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm0 0V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v10m-6 0a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2m0 0V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2z"/>
                </svg>
            </div>
            <div class="kpi-content">
                <span class="kpi-value">@_experiments.Count</span>
                <span class="kpi-label">Total Experiments</span>
            </div>
            <div class="kpi-trend positive">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                <span>Active</span>
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-icon green">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
            </div>
            <div class="kpi-content">
                <span class="kpi-value">@_experiments.Count(e => e.Status == "Active" && !DemoState.GetKillSwitch(e.Name))</span>
                <span class="kpi-label">Running Tests</span>
            </div>
            <div class="kpi-trend positive">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                <span>100% healthy</span>
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-icon purple">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
            </div>
            <div class="kpi-content">
                <span class="kpi-value">@FormatNumber(_totalImpressions)</span>
                <span class="kpi-label">Total Impressions</span>
            </div>
            <div class="kpi-trend positive">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                <span>+12.5% MTD</span>
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-icon amber">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="20" x2="12" y2="10"/>
                    <line x1="18" y1="20" x2="18" y2="4"/>
                    <line x1="6" y1="20" x2="6" y2="16"/>
                </svg>
            </div>
            <div class="kpi-content">
                <span class="kpi-value">+8.3%</span>
                <span class="kpi-label">Avg. Conversion Lift</span>
            </div>
            <div class="kpi-trend positive">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg>
                <span>Above target</span>
            </div>
        </div>
    </section>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
        <!-- Experiment Status -->
        <section class="card experiments-status">
            <div class="card-header">
                <h2>Experiment Status</h2>
                <a href="experiments" class="card-link">View all</a>
            </div>
            <div class="card-body">
                @if (_experiments.Any())
                {
                    <div class="experiment-table">
                        <div class="table-header">
                            <span>Experiment</span>
                            <span>Category</span>
                            <span>Active Variant</span>
                            <span>Status</span>
                        </div>
                        @foreach (var exp in _experiments.Take(5))
                        {
                            var isKilled = DemoState.GetKillSwitch(exp.Name);
                            var displayStatus = isKilled ? "Killed" : exp.Status;
                            <div class="table-row">
                                <div class="exp-name">
                                    <strong>@exp.DisplayName</strong>
                                    <span>@exp.Variants.Count variants</span>
                                </div>
                                <span class="category-badge @exp.Category.ToLower()">@exp.Category</span>
                                <span class="variant-name">@GetVariantDisplayName(exp)</span>
                                <span class="status-badge @displayStatus.ToLower()">@displayStatus</span>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-state">
                        <p>No experiments configured</p>
                    </div>
                }
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="card quick-actions">
            <div class="card-header">
                <h2>Quick Actions</h2>
            </div>
            <div class="card-body">
                <div class="action-grid">
                    <a href="experiments" class="action-item">
                        <div class="action-icon blue">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/>
                                <line x1="9" y1="21" x2="9" y2="9"/>
                            </svg>
                        </div>
                        <div class="action-text">
                            <strong>Experiment Console</strong>
                            <span>Manage variants & targeting</span>
                        </div>
                    </a>
                    <a href="demo" class="action-item">
                        <div class="action-icon green">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                        </div>
                        <div class="action-text">
                            <strong>Test Environment</strong>
                            <span>Preview experiment behavior</span>
                        </div>
                    </a>
                    <a href="analytics" class="action-item">
                        <div class="action-icon purple">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"/>
                                <line x1="12" y1="20" x2="12" y2="4"/>
                                <line x1="6" y1="20" x2="6" y2="14"/>
                            </svg>
                        </div>
                        <div class="action-text">
                            <strong>Analytics</strong>
                            <span>Performance & audit logs</span>
                        </div>
                    </a>
                    <a href="plugins" class="action-item">
                        <div class="action-icon amber">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                            </svg>
                        </div>
                        <div class="action-text">
                            <strong>Extensions</strong>
                            <span>Plugins & integrations</span>
                        </div>
                    </a>
                </div>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="card recent-activity">
            <div class="card-header">
                <h2>Recent Activity</h2>
                <a href="analytics" class="card-link">View audit log</a>
            </div>
            <div class="card-body">
                @if (_auditEvents.Any())
                {
                    <div class="activity-list">
                        @foreach (var evt in _auditEvents.Take(6))
                        {
                            <div class="activity-item">
                                <div class="activity-icon @GetEventIconClass(evt.EventType)">
                                    @GetEventIcon(evt.EventType)
                                </div>
                                <div class="activity-content">
                                    <span class="activity-title">@GetEventTitle(evt)</span>
                                    <span class="activity-time">@FormatTimeAgo(evt.Timestamp)</span>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-state">
                        <p>No recent activity</p>
                    </div>
                }
            </div>
        </section>

        <!-- System Health -->
        <section class="card system-health">
            <div class="card-header">
                <h2>System Health</h2>
                <span class="health-status online">All systems operational</span>
            </div>
            <div class="card-body">
                <div class="health-grid">
                    <div class="health-item">
                        <div class="health-indicator green"></div>
                        <span class="health-label">API Service</span>
                        <span class="health-value">Healthy</span>
                    </div>
                    <div class="health-item">
                        <div class="health-indicator green"></div>
                        <span class="health-label">Experiment Engine</span>
                        <span class="health-value">Healthy</span>
                    </div>
                    <div class="health-item">
                        <div class="health-indicator green"></div>
                        <span class="health-label">Audit System</span>
                        <span class="health-value">Healthy</span>
                    </div>
                    <div class="health-item">
                        <div class="health-indicator green"></div>
                        <span class="health-label">Plugin Host</span>
                        <span class="health-value">@_pluginCount plugins</span>
                    </div>
                </div>
                <div class="uptime-info">
                    <span>Uptime: 99.97%</span>
                    <span>Last incident: None</span>
                </div>
            </div>
        </section>
    </div>
</div>

@code {
    private List<ExperimentInfo> _experiments = [];
    private List<AuditLogEntry> _auditEvents = [];
    private int _totalImpressions = 0;
    private int _pluginCount = 0;
    private bool _loading = true;
    private bool _dataLoaded = false;

    protected override void OnInitialized()
    {
        DemoState.OnStateChanged += HandleStateChanged;
    }

    private void HandleStateChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        DemoState.OnStateChanged -= HandleStateChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_dataLoaded)
        {
            _dataLoaded = true;
            await RefreshData();
            StateHasChanged();
        }
    }

    private async Task RefreshData()
    {
        _loading = true;
        using var cts = new CancellationTokenSource(TimeSpan.FromSeconds(10));
        try
        {
            // Run API calls with timeout protection
            var experimentsTask = SafeApiCall(() => ExperimentApi.GetExperimentsAsync(), new List<ExperimentInfo>(), cts.Token);
            var auditTask = SafeApiCall(() => ExperimentApi.GetAuditLogAsync(10), new List<AuditLogEntry>(), cts.Token);
            var pluginsTask = SafeApiCall(() => ExperimentApi.GetPluginsAsync(), new List<PluginInfo>(), cts.Token);
            var usageTask = SafeApiCall(() => ExperimentApi.GetUsageStatsAsync(), new Dictionary<string, Dictionary<string, int>>(), cts.Token);
            var killSwitchTask = SafeApiCall(() => ExperimentApi.GetKillSwitchStatusesAsync(), new List<KillSwitchStatus>(), cts.Token);

            await Task.WhenAll(experimentsTask, auditTask, pluginsTask, usageTask, killSwitchTask);

            _experiments = await experimentsTask;
            _auditEvents = await auditTask;
            _pluginCount = (await pluginsTask).Count;
            var usage = await usageTask;
            _totalImpressions = usage.Values.SelectMany(v => v.Values).Sum();

            // Sync kill switch states
            var killSwitches = await killSwitchTask;
            DemoState.SyncKillSwitchesFromApi(killSwitches);
        }
        catch (OperationCanceledException)
        {
            // Timeout - use defaults
        }
        catch
        {
            // Handle gracefully
        }
        finally
        {
            _loading = false;
        }
    }

    private async Task<T> SafeApiCall<T>(Func<Task<T>> apiCall, T defaultValue, CancellationToken ct)
    {
        try
        {
            return await apiCall().WaitAsync(ct);
        }
        catch
        {
            return defaultValue;
        }
    }

    private string GetVariantDisplayName(ExperimentInfo exp)
    {
        var variant = exp.Variants.FirstOrDefault(v => v.Name == exp.ActiveVariant);
        return variant?.DisplayName ?? exp.ActiveVariant;
    }

    private string FormatNumber(int number)
    {
        if (number >= 1000000)
            return $"{number / 1000000.0:F1}M";
        if (number >= 1000)
            return $"{number / 1000.0:F1}K";
        return number.ToString("N0");
    }

    private string FormatTimeAgo(DateTime timestamp)
    {
        var diff = DateTime.UtcNow - timestamp;
        if (diff.TotalMinutes < 1)
            return "Just now";
        if (diff.TotalMinutes < 60)
            return $"{(int)diff.TotalMinutes}m ago";
        if (diff.TotalHours < 24)
            return $"{(int)diff.TotalHours}h ago";
        return $"{(int)diff.TotalDays}d ago";
    }

    private string GetEventIconClass(string eventType) => eventType switch
    {
        "VariantSelected" => "blue",
        "ExperimentModified" => "amber",
        "ExperimentCreated" => "green",
        "ExperimentStopped" => "red",
        _ => "gray"
    };

    private MarkupString GetEventIcon(string eventType) => eventType switch
    {
        "VariantSelected" => new MarkupString("<svg width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><polyline points='20 6 9 17 4 12'/></svg>"),
        "ExperimentModified" => new MarkupString("<svg width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7'/><path d='M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z'/></svg>"),
        "ExperimentCreated" => new MarkupString("<svg width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><circle cx='12' cy='12' r='10'/><line x1='12' y1='8' x2='12' y2='16'/><line x1='8' y1='12' x2='16' y2='12'/></svg>"),
        "ExperimentStopped" => new MarkupString("<svg width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><circle cx='12' cy='12' r='10'/><line x1='15' y1='9' x2='9' y2='15'/><line x1='9' y1='9' x2='15' y2='15'/></svg>"),
        _ => new MarkupString("<svg width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><circle cx='12' cy='12' r='10'/></svg>")
    };

    private string GetEventTitle(AuditLogEntry evt)
    {
        var expName = evt.ExperimentName ?? "Unknown";
        return evt.EventType switch
        {
            "VariantSelected" => $"Variant selected for {expName}",
            "ExperimentModified" => $"Configuration updated: {expName}",
            "ExperimentCreated" => $"New experiment: {expName}",
            "ExperimentStopped" => $"Experiment stopped: {expName}",
            _ => evt.Details
        };
    }
}

<style>
    .dashboard {
        padding: 0;
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Header */
    .dashboard-header {
        margin-bottom: 1.5rem;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .header-title h1 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--color-text-primary, #0f172a);
        margin: 0;
        letter-spacing: -0.02em;
    }

    .header-subtitle {
        font-size: 0.9rem;
        color: var(--color-text-secondary, #64748b);
        margin: 0.25rem 0 0;
    }

    .header-actions {
        display: flex;
        gap: 0.75rem;
    }

    .btn-primary, .btn-secondary {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 150ms ease;
    }

    .btn-primary {
        background: var(--color-primary, #6366f1);
        color: white;
    }

    .btn-primary:hover {
        background: var(--color-primary-hover, #4f46e5);
    }

    .btn-secondary {
        background: var(--color-bg-secondary, white);
        color: var(--color-text-primary, #0f172a);
        border: 1px solid var(--color-border, rgba(148, 163, 184, 0.3));
    }

    .btn-secondary:hover {
        background: var(--color-bg-tertiary, #f1f5f9);
    }

    /* KPI Section */
    .kpi-section {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .kpi-card {
        background: var(--color-bg-secondary, white);
        border-radius: 12px;
        padding: 1.25rem;
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        border: 1px solid var(--color-border, rgba(148, 163, 184, 0.2));
        position: relative;
    }

    .kpi-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .kpi-icon.blue { background: rgba(99, 102, 241, 0.1); color: #6366f1; }
    .kpi-icon.green { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .kpi-icon.purple { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
    .kpi-icon.amber { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

    .kpi-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .kpi-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--color-text-primary, #0f172a);
        line-height: 1.2;
        letter-spacing: -0.02em;
    }

    .kpi-label {
        font-size: 0.8rem;
        color: var(--color-text-secondary, #64748b);
        margin-top: 0.125rem;
    }

    .kpi-trend {
        position: absolute;
        top: 1rem;
        right: 1rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.7rem;
        font-weight: 500;
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
    }

    .kpi-trend.positive { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .kpi-trend.negative { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

    /* Dashboard Grid */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1.5fr 1fr;
        gap: 1rem;
    }

    /* Cards */
    .card {
        background: var(--color-bg-secondary, white);
        border-radius: 12px;
        border: 1px solid var(--color-border, rgba(148, 163, 184, 0.2));
        overflow: hidden;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--color-border, rgba(148, 163, 184, 0.15));
    }

    .card-header h2 {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--color-text-primary, #0f172a);
        margin: 0;
    }

    .card-link {
        font-size: 0.8rem;
        color: var(--color-primary, #6366f1);
        text-decoration: none;
        font-weight: 500;
    }

    .card-link:hover {
        text-decoration: underline;
    }

    .card-body {
        padding: 1rem 1.25rem;
    }

    /* Experiment Table */
    .experiment-table {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .table-header {
        display: grid;
        grid-template-columns: 2fr 1fr 1.5fr 0.75fr;
        gap: 1rem;
        padding: 0 0.5rem 0.75rem;
        border-bottom: 1px solid var(--color-border, rgba(148, 163, 184, 0.15));
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-text-muted, #94a3b8);
    }

    .table-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1.5fr 0.75fr;
        gap: 1rem;
        padding: 0.75rem 0.5rem;
        align-items: center;
        border-radius: 8px;
        transition: background 150ms ease;
    }

    .table-row:hover {
        background: var(--color-bg-tertiary, rgba(148, 163, 184, 0.08));
    }

    .exp-name {
        display: flex;
        flex-direction: column;
    }

    .exp-name strong {
        font-size: 0.875rem;
        color: var(--color-text-primary, #0f172a);
    }

    .exp-name span {
        font-size: 0.75rem;
        color: var(--color-text-muted, #94a3b8);
    }

    .category-badge {
        font-size: 0.7rem;
        font-weight: 500;
        padding: 0.25rem 0.625rem;
        border-radius: 6px;
        text-transform: uppercase;
        letter-spacing: 0.02em;
    }

    .category-badge.revenue { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .category-badge.engagement { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
    .category-badge.ux { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }

    .variant-name {
        font-size: 0.8rem;
        color: var(--color-text-secondary, #64748b);
    }

    .status-badge {
        font-size: 0.7rem;
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        text-transform: uppercase;
    }

    .status-badge.active { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .status-badge.paused { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
    .status-badge.completed { background: rgba(148, 163, 184, 0.2); color: #64748b; }
    .status-badge.killed { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

    /* Quick Actions */
    .action-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
    }

    .action-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem;
        border-radius: 10px;
        text-decoration: none;
        border: 1px solid var(--color-border, rgba(148, 163, 184, 0.2));
        transition: all 150ms ease;
    }

    .action-item:hover {
        border-color: var(--color-primary, #6366f1);
        background: var(--color-bg-tertiary, rgba(99, 102, 241, 0.04));
    }

    .action-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .action-icon.blue { background: rgba(99, 102, 241, 0.1); color: #6366f1; }
    .action-icon.green { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .action-icon.purple { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
    .action-icon.amber { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

    .action-text {
        display: flex;
        flex-direction: column;
    }

    .action-text strong {
        font-size: 0.8rem;
        color: var(--color-text-primary, #0f172a);
        font-weight: 600;
    }

    .action-text span {
        font-size: 0.7rem;
        color: var(--color-text-muted, #94a3b8);
    }

    /* Recent Activity */
    .activity-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .activity-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .activity-icon {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .activity-icon.blue { background: rgba(99, 102, 241, 0.1); color: #6366f1; }
    .activity-icon.green { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .activity-icon.amber { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
    .activity-icon.red { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
    .activity-icon.gray { background: rgba(148, 163, 184, 0.15); color: #64748b; }

    .activity-content {
        flex: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .activity-title {
        font-size: 0.8rem;
        color: var(--color-text-primary, #0f172a);
    }

    .activity-time {
        font-size: 0.7rem;
        color: var(--color-text-muted, #94a3b8);
    }

    /* System Health */
    .health-status {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 0.25rem 0.625rem;
        border-radius: 6px;
    }

    .health-status.online { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .health-status.degraded { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
    .health-status.offline { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

    .health-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .health-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem;
        background: var(--color-bg-tertiary, rgba(148, 163, 184, 0.08));
        border-radius: 8px;
    }

    .health-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .health-indicator.green { background: #10b981; box-shadow: 0 0 6px rgba(16, 185, 129, 0.5); }
    .health-indicator.amber { background: #f59e0b; box-shadow: 0 0 6px rgba(245, 158, 11, 0.5); }
    .health-indicator.red { background: #ef4444; box-shadow: 0 0 6px rgba(239, 68, 68, 0.5); }

    .health-label {
        flex: 1;
        font-size: 0.75rem;
        color: var(--color-text-secondary, #64748b);
    }

    .health-value {
        font-size: 0.75rem;
        font-weight: 500;
        color: var(--color-text-primary, #0f172a);
    }

    .uptime-info {
        display: flex;
        justify-content: space-between;
        padding-top: 0.75rem;
        border-top: 1px solid var(--color-border, rgba(148, 163, 184, 0.15));
        font-size: 0.7rem;
        color: var(--color-text-muted, #94a3b8);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 2rem;
        color: var(--color-text-muted, #94a3b8);
        font-size: 0.875rem;
    }

    /* Dark Theme */
    :global(.theme-dark) .kpi-card,
    :global(.theme-dark) .card {
        background: var(--color-bg-secondary, #1e293b);
        border-color: rgba(255, 255, 255, 0.1);
    }

    :global(.theme-dark) .table-row:hover,
    :global(.theme-dark) .health-item {
        background: rgba(255, 255, 255, 0.05);
    }

    :global(.theme-dark) .action-item {
        background: rgba(255, 255, 255, 0.03);
        border-color: rgba(255, 255, 255, 0.1);
    }

    :global(.theme-dark) .action-item:hover {
        background: rgba(99, 102, 241, 0.15);
        border-color: rgba(99, 102, 241, 0.4);
    }

    :global(.theme-dark) .action-text strong {
        color: #f1f5f9;
    }

    :global(.theme-dark) .action-text span {
        color: #94a3b8;
    }

    :global(.theme-dark) .activity-item {
        border-color: rgba(255, 255, 255, 0.08);
    }

    :global(.theme-dark) .activity-text strong {
        color: #f1f5f9;
    }

    /* Responsive */
    @@media (max-width: 1200px) {
        .kpi-section {
            grid-template-columns: repeat(2, 1fr);
        }

        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }

    @@media (max-width: 640px) {
        .kpi-section {
            grid-template-columns: 1fr;
        }

        .header-content {
            flex-direction: column;
        }

        .header-actions {
            width: 100%;
        }

        .header-actions .btn-primary,
        .header-actions .btn-secondary {
            flex: 1;
            justify-content: center;
        }

        .table-header,
        .table-row {
            grid-template-columns: 1fr 1fr;
        }

        .table-header span:nth-child(3),
        .table-header span:nth-child(4),
        .table-row .variant-name,
        .table-row .status-badge {
            display: none;
        }

        .action-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
